#!/bin/bash
set -e

FORCE=false

# Parse arguments
while [[ $# -gt 0 ]]; do
  case $1 in
    --force)
      FORCE=true
      shift
      ;;
    *)
      shift
      ;;
  esac
done

echo "üîß  Setting up lint scripts in composer.json..."

add_or_override_script() {
  local name=$1
  local command=$2

  if grep -q "\"$name\":" composer.json; then
    if [ "$FORCE" = true ]; then
      echo "‚öôÔ∏è  Overriding script '$name'"
      composer config scripts."$name" "$command"
    else
      echo "‚ÑπÔ∏è  Script '$name' already exists. Skipping..."
    fi
  else
    echo "‚ûï  Adding script '$name'"
    composer config scripts."$name" "$command"
  fi
}

add_or_override_script "lint" "vendor/bin/programic-lint"
add_or_override_script "lint:phpstan" "vendor/bin/programic-lint --only=phpstan"

echo "üéâ  Linting config setup complete!"
